---
layout: post
title: "Today I learned 21.06.17"
category: MEMO
date: 2021-06-17 19:00:00 +0900
---
## CS

### 1. Network

1. TCP

    ![TCP](https://user-images.githubusercontent.com/77161691/126037754-b5dca10a-a598-41e5-a3da-e8e16b70cbda.png)

    - 연결형 서비스(가상 회선 방식)를 사용하는 전송 계층 프로토콜
    - 흐름 제어, 오류 제어, 혼잡 제어를 통한 신뢰성 보장. (데이터 전송 순서 보장, 수신 여부 확인 가능)
    - IP와 함께 사용. IP는 데이터의 전송 담당. TCP는 패킷의 추적 및 관리 담당.
    1. 흐름 제어
        - 데이터 송신측과 수신측의 데이터 처리 속도 차이로 인해 수신측의 버퍼 오버플로우가 생길 수 있음. → 송신측의 패킷 전송량을 조절하여 데이터 손실 방지.
        1. Stop and Wait
            - 매번 전송한 패킷에 대한 확인 응답을 받고 다음 패킷 전송. (비효율적)
        2. Sliding Window
            - 수신측에서 설정한 윈도우 크기만큼 송신측에서 확인 응답(Ack 프레임) 없이 segment를 우선 전송. 수신측으로부터 ACK 프레임을 받으면 송신측은 ACK에 따른 프레임의 수만큼 윈도우 경계 확장. ([https://roka88.dev/114](https://roka88.dev/114))
        - Nagle 알고리즘 : 데이터를 최대한 MSS 단위로 보내어 패킷 헤더에 의한 오버 헤드 비율을 감소
            - 전송하기 위한 새로운 데이터가 있을 때, **MSS** 보다 송신 윈도우 사이즈가 같거나 크고 이용할 수 있는 데이터가 **MSS** 보다 같거나 큰 경우에만 **MSS** 만큼 세그먼트를 보냄. 그렇지 않다면, 확인 응답을 받을 때 까지 데이터를 버퍼에 더한다. 확인 응답을 받으면 버퍼의 데이터를 바로 보냄.
    2. 혼잡 제어
        - 한 라우터에 데이터가 몰려 모든 데이터를 처리할 수 없는 경우 버퍼 오버플로우가 발생할 수 있음. → 송신측의 패킷 전송량을 조절하여 데이터 손실 방지. 수 많은 혼잡 제어 알고리즘이 있음.
        - TCP Reno : 혼잡제어 알고리즘의 한 종류
            - 혼잡 감지
                1. RTO(Retransmission time-out) 타이머에 의한 시간 내에 segment가 도착하지 않은 경우
                2. 수신측의 동일한 ackNo의 확인 응답을 송신측에서 세 번 이상 수신했을 경우
            - 느린 시작(Slow start) : 혼잡 회피 상태가 될 때까지 cwnd(혼잡 윈도우 변수)를 지수 증가(2배).
            - 혼잡 회피(Congestion Avoidance) : cwnd(혼잡 윈도우 변수)를 가산 증가(+1).
            - 빠른 회복(Fast recovery) : 느린시작 or 혼잡 회피 상태에서 세 번 이상의 동일한 ackNo 확인 응답을 받은 경우 돌입. cwnd를 절반으로 줄이고 혼잡 회피 상태로 돌입.
    3. 오류 제어
        - 훼손 or 중복된 패킷의 감지 및 폐기, 순서에 맞지 않는 세그먼트를 버퍼에 저장하고 훼손 or 중복된 패킷을 재전송.
        - 검사합
        - 확인 응답
            - 5가지 정책
                1. 이전에 수신된 세그먼트에 대해 확인 응답을 한 경우 또 다른 다른 세그먼트가 도착하거나 500ms의 시간이 지나기 까지 ACK 세그먼트의 전송을 보류. (지연된 확인 응답)
                2. 시간 500ms 이내에 새로운 세그먼트가 도착하지 않을 경우 그 즉시 수신한 세그먼트에 대해 확인 응답을 보내야 함.
                3. 지연과 상관없이 확인 응답 하지 않은 세그먼트를 2개 이상 보유하지 않음.
                4. 순서에 맞지 않는 세그먼트를 수신 시 바로 수신측이 올바르게 받아야 할 세그먼트 순서 번호를 전송함. (빠른 재전송)
                5. 네트워크 혼잡 등으로 인해 세그먼트가 재전송되어 중복된 세그먼트를 수신하는 경우 폐기.
            - 2가지 방식
                1. 누적 확인 응답(ACK, Go-Back-N 방식)

                    확인 응답의 ackNo까지는 정상적인 순서로 수신되었다는 것을 알리며 송신측에서 보내야 할 다음의 순서 번호까지 알려줌.

                2. 선택 확인 응답(SACK, Selective-Repeat 방식)

                    정상적으로 수신한 ackNo = seqNo만을 전송하는 방식. 다음의 순서 번호는 알려주지 않음.

        - 타임아웃 : RTO 타이머 이내에 손실된 세그먼트 수신 or 세그먼트 미수신(타임아웃) → 재전송 요청
        - ARQ(Automatic Repeat Request) : 프레임이 손상되었거나 손실되었을 경우, 재전송을 통해 오류를 복구.
            1. Go-Back-n ARQ
                - 전송된 프레임이 손상되거나 분실된 경우, 그리고 ACK 패킷의 손실로 인한 TIME_OUT이 발생한 경우, 확인된 마지막 프레임 이후로 모든 프레임을 재전송.
                - 송신측은 전송된 모든 프레임의 복사본을 가지고 있어야 하며, ACK와 NAK 모두 각각 구별해야 함.
                - ACK : 다음 프레임을 전송.
                - NAK : 손상된 프레임 자체 번호를 반환.
            2. SR(Selective-Reject) ARQ
                - 손상되거나 손실된 프레임만 재전송. 별도의 데이터 재정렬 및 버퍼 필요.
